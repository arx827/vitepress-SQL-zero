<!DOCTYPE html>
<html lang="zh-TW" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第 5 章 進階查詢功能 | 從零開始 邁向數據分析 SQL 資料庫語法入門</title>
    <meta name="description" content="閱讀筆記">
    <link rel="preload stylesheet" href="/vitepress-SQL-zero/assets/style.721c165b.css" as="style">
    <link rel="modulepreload" href="/vitepress-SQL-zero/assets/app.12066fee.js">
    <link rel="modulepreload" href="/vitepress-SQL-zero/assets/guide_chapter_5.md.3d608a90.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-93a960b4><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-93a960b4 data-v-790c334c><div class="VPNavBar has-sidebar" data-v-790c334c data-v-eda5fd6f><div class="container" data-v-eda5fd6f><div class="title" data-v-eda5fd6f><div class="VPNavBarTitle has-sidebar" data-v-eda5fd6f data-v-6d2fb2d9><a class="title" href="/vitepress-SQL-zero/" data-v-6d2fb2d9><!--[--><!--]--><!--[--><img class="VPImage logo" src="/vitepress-SQL-zero/apple-touch-icon.png" alt data-v-6db2186b><!--]--><!--[-->從零開始 邁向數據分析 SQL 資料庫語法入門<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-eda5fd6f><div class="curtain" data-v-eda5fd6f></div><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-eda5fd6f data-v-bdedfc22><span id="main-nav-aria-label" class="visually-hidden" data-v-bdedfc22>Main Navigation</span><!--[--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-eda5fd6f data-v-da3f667a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-da3f667a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-eda5fd6f data-v-f38c483a data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-96001b6b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-96001b6b><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-f38c483a><div class="item appearance" data-v-f38c483a><p class="label" data-v-f38c483a>Appearance</p><div class="appearance-action" data-v-f38c483a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-f38c483a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-eda5fd6f data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-93a960b4 data-v-2817d72e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2817d72e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2817d72e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2817d72e>Menu</span></button><a class="top-link" href="#" data-v-2817d72e>Return to top</a></div><aside class="VPSidebar" data-v-93a960b4 data-v-941101de><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-941101de><span class="visually-hidden" id="sidebar-aria-label" data-v-941101de> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-941101de><section class="VPSidebarGroup" data-v-941101de data-v-c88a18d6><div class="title" data-v-c88a18d6><h2 class="title-text" data-v-c88a18d6>目錄</h2><div class="action" data-v-c88a18d6><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-c88a18d6><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-c88a18d6><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-c88a18d6><!--[--><!--[--><a class="VPLink link link" href="/vitepress-SQL-zero/guide/chapter_0.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 0 章 建構 SQL 執行環境</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/vitepress-SQL-zero/guide/chapter_1.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 1 章 資料庫與SQL</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/vitepress-SQL-zero/guide/chapter_2.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 2 章 查詢的基本語法</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/vitepress-SQL-zero/guide/chapter_3.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 3 章 彙總與排序</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/vitepress-SQL-zero/guide/chapter_4.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 4 章 更新資料</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/vitepress-SQL-zero/guide/chapter_5.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 5 章 進階查詢功能</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/vitepress-SQL-zero/guide/chapter_6.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 6 章 函數、述詞、CASE 運算式</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/vitepress-SQL-zero/guide/chapter_7.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 7 章 集合運算 (合併查詢)</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/vitepress-SQL-zero/guide/chapter_8.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 8 章 SQL 進階處理功能</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/vitepress-SQL-zero/guide/chapter_9.html" style="padding-left:0px;" tabindex="-1" data-v-4a1a7e6c data-v-3c355974><!--[--><span class="link-text" data-v-4a1a7e6c>第 9 章 從應用程式連接資料庫</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-93a960b4 data-v-0bd490fb><div class="VPDoc has-sidebar has-aside" data-v-0bd490fb data-v-c5936a1e><div class="container" data-v-c5936a1e><div class="aside" data-v-c5936a1e><div class="aside-curtain" data-v-c5936a1e></div><div class="aside-container" data-v-c5936a1e><div class="aside-content" data-v-c5936a1e><div class="VPDocAside" data-v-c5936a1e data-v-cdc66372><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-cdc66372 data-v-0627715d><div class="content" data-v-0627715d><div class="outline-marker" data-v-0627715d></div><div class="outline-title" data-v-0627715d>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-0627715d><span class="visually-hidden" id="doc-outline-aria-label" data-v-0627715d> Table of Contents for current page </span><ul class="root" data-v-0627715d data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cdc66372></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c5936a1e><div class="content-container" data-v-c5936a1e><!--[--><!--]--><main class="main" data-v-c5936a1e><div style="position:relative;" class="vp-doc _vitepress-SQL-zero_guide_chapter_5" data-v-c5936a1e><div><h1 id="第-5-章-進階查詢功能" tabindex="-1">第 5 章 進階查詢功能 <a class="header-anchor" href="#第-5-章-進階查詢功能" aria-hidden="true">#</a></h1><h2 id="_5-1-檢視表" tabindex="-1">5-1 檢視表 <a class="header-anchor" href="#_5-1-檢視表" aria-hidden="true">#</a></h2><div class="info custom-block"><p class="custom-block-title">學習重點</p><ul><li>若從 <code>SQL</code> 的觀點來看，<code>檢視表</code> 可說是「 等同於資料表的東西 」。 2 者的差異在於資料表當中儲存著「 實際的資料 」，而 <code>檢視表</code> 當中所儲存的事「 <code>SELECT 敘述</code> 」( <code>檢視表</code> 本身不具有資料內容)。</li><li>若運用檢視表的功能，對於所需資料存放於多個資料表之類的狀況，亦能輕鬆地完成複雜的資料彙集操作。</li><li>將經常使用的 <code>SELECT 敘述</code> 製作成 <code>檢視表</code>，便能重複利用。</li><li>建立 <code>檢視表</code> 時，需要使用 <code>CREATE VIEW 敘述</code>。</li><li><code>檢視表</code> 在使用上具有「 不能使用 <code>ORDER BY 子句</code> 」以及「 可透過 <code>檢視表</code> 更新資料、但是有些限制條件 」等 2 項限制項目。</li><li>刪除 <code>檢視表</code> 時，需要使用 <code>DROP VIEW 敘述</code>。</li></ul></div><h3 id="檢視表與資料表" tabindex="-1">檢視表與資料表 <a class="header-anchor" href="#檢視表與資料表" aria-hidden="true">#</a></h3><p>從 <code>SQL</code> 的觀點來看，<code>檢視表</code> 可說等同於資料表。實際上在 <code>SQL 敘述</code> 之中，幾乎不必特意區分此為資料表或是 <code>檢視表</code>，只有「 <code>更新</code> 」資料的時候才需要留意 2 者的差異。</p><p>2 者的差異其實僅在於「 <code>是否儲存著實際的資料</code> 」。</p><p>通常我們會先建立資料表，然後以 <code>INSERT 敘述</code> 新增資料，利用這樣的方式將資料存入資料庫之中。而說到資料庫中的資料的真實存放位置，其實是位於電腦內部的 <code>儲存裝置</code> (一般為硬碟)，因此，之後執行 <code>SELECT 敘述</code> 查詢資料的時候，實際上是從儲存裝置 (硬碟) 取出資料，再進行各種運算處理，最後將資料回傳給使用者，此為大致上的流程。</p><p><code>檢視表</code> 的機制不會在儲存裝置中存入資料。可以說 <code>檢視表 的儲存空間中沒有任何資料</code>，實際上，它所儲存的僅是 「 <code>SELECT 敘述</code> 」，而想從 <code>檢視表</code> 取出資料的時候，其實是先執行 <code>檢視表</code> 內部存放的 <code>SELECT 敘述</code>，暫時建立出虛擬的資料表，之後再從中取出資料。</p><ul><li><h4 id="檢視表的優點" tabindex="-1">檢視表的優點 <a class="header-anchor" href="#檢視表的優點" aria-hidden="true">#</a></h4> 檢視表大致上具有下列 2 個優點。 <ul><li><p>第 1 個，因為不儲存資料所以可以節省儲存裝置的容量。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-1</p><p>檢視表只需儲存 <code>SELECT 敘述</code> 即可</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(sell_price), </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(buying_price)</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg;</span></span>
<span class="line"></span></code></pre></div></div><div class="tip custom-block"><p class="custom-block-title">牢記的原則 5-1</p><p>相對於資料表儲存著「 真實的資料 」，<code>檢視表</code> 僅儲存著用來從資料表取出資料的「 <code>SELECT 敘述</code> 」。</p></div></li><li><p>第 2 個優點，若將頻繁使用的 <code>SELECT 敘述</code> 預先存成檢視表的形式，那麼就不必每次輸入相同的敘述，也能重複利用取出同樣的資料集。</p><p>而且，檢視表所包含的資料會與原本的資料表產生連動，隨時自動更新到最新的資料內容或狀態。由於檢視表每次「 參照檢視表中的資料 」時，其實是「 執行該 <code>SELECT 敘述</code> 」，因此可以篩選出最新狀態的資料，這也是將資料另存資料表所辦不到的優點。</p><div class="tip custom-block"><p class="custom-block-title">牢記的原則 5-2</p><p>經常使用的 <code>SELECT 敘述</code> 可以轉為檢視表，方便重複利用。</p></div></li></ul></li></ul><h3 id="檢視表的建立方式" tabindex="-1">檢視表的建立方式 <a class="header-anchor" href="#檢視表的建立方式" aria-hidden="true">#</a></h3><p>建立 <code>檢視表</code> 需要使用 <code>CREATE VIEW 敘述</code>。</p><div class="warning custom-block"><p class="custom-block-title">語法 5-1</p><p>建立檢視表的 <code>CREATE VIEW 敘述</code></p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> VIEW </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">檢視表名稱</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">檢視表欄位名稱1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">檢視表欄位名稱2</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">, ...)</span></span>
<span class="line"><span style="color:#F78C6C;">AS</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> 敘述</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div></div><p><code>AS 關鍵字</code> 的後方便是撰寫 <code>SELECT 敘述</code> 的位置，<code>SELECT 敘述</code> 所取得的欄位排列順序會和檢視表的欄位排列順序一致。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-2</p><p>ShohinSum 檢視表</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight has-highlighted-lines"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">VIEW</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ShohinSum</span><span style="color:#A6ACCD;"> (shohin_catalg, cnt_shohin)</span></span>
<span class="line"><span style="color:#F78C6C;">AS</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg;</span></span>
<span class="line"></span></code></pre></div><p><code>AS</code> 是絕對不能省略的部分。</p></div><p>使用方式，其實 <code>檢視表</code> 在使用上和資料表並無不同，只要將它的名稱寫在 <code>SELECT 敘述</code> 的 <code>FROM</code> 子句部分即可。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-3</p><p>使用 檢視表</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, cnt_shohin</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> ShohinSum;</span></span>
<span class="line"></span></code></pre></div></div><p>建立 <code>檢視表</code> 的時候，可以寫入各種形式的 <code>SELECT 敘述</code>。</p><ul><li><h4 id="對檢視表進行查詢" tabindex="-1">對檢視表進行查詢 <a class="header-anchor" href="#對檢視表進行查詢" aria-hidden="true">#</a></h4><p>在 <code>FROM 子句</code> 中指定 <code>檢視表</code> 進行查詢的時候，會依循下列 2 個階段的步驟。</p><ol><li>先執行建立檢視表當時所定義的 <code>SELECT 敘述</code>。</li><li>將該結果當作 <code>FROM 子句</code> 所指定的資料來源，完成此 <code>SELECT 敘述</code> 的執行動作。</li></ol><p>以 <code>檢視表</code> 為對象的查詢動作，總是需要執行 2 段以上的 <code>SELECT 敘述</code>。</p><p><code>多層檢視表</code>：建立 <code>檢視表</code> 的時候也能指定其他 <code>檢視表</code> 當作資料來源，形成類似「 疊床架屋 」的架構。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-4</p><p>ShohinSumJim 檢視表</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">VIEW</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ShohinSumJim</span><span style="color:#A6ACCD;"> (shohin_catalg, cnt_shohin)</span></span>
<span class="line"><span style="color:#F78C6C;">AS</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, cnt_shohin</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> ShohinSum</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> shohin_catalg </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">辦公用品</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div></div><p>盡量避免在 <code>檢視表</code> 上反覆重疊建立 <code>檢視表</code>，因為以大部分的 <code>DBMS</code> 來說，<code>重疊建立檢視表的做法將會招致資料庫的效能低落</code>。請盡可能維持在只使用單層 <code>檢視表</code> 的方式。</p><div class="tip custom-block"><p class="custom-block-title">牢記的原則 5-3</p><p>請 (盡量) 避免在 <code>檢視表</code> 上重疊建立 <code>檢視表</code>。</p></div></li></ul><h3 id="檢視表的限制-1-建立時不可使用-order-by-子句" tabindex="-1">檢視表的限制-1：建立時不可使用 ORDER BY 子句 <a class="header-anchor" href="#檢視表的限制-1-建立時不可使用-order-by-子句" aria-hidden="true">#</a></h3><p>若要探討為什麼不能使用 <code>ORDER BY 子句</code>，其實和資料表的道理相同，因為檢視表也被設定成「 各筆紀錄沒有先後順序 」的緣故。</p><div class="tip custom-block"><p class="custom-block-title">牢記的原則 5-4</p><p>建立資料表的敘述中請勿使用 <code>ORDER BY 子句</code></p></div><h3 id="檢視表的限制-2-透過檢視表更新資料" tabindex="-1">檢視表的限制-2：透過檢視表更新資料 <a class="header-anchor" href="#檢視表的限制-2-透過檢視表更新資料" aria-hidden="true">#</a></h3><p>雖然訂有嚴格的限制，不過還是有機會透過 <code>檢視表</code> 更新原資料表中實際儲存的資料，在標準 <code>SQL</code> 中有著如下的規定：</p><p>「 用來建立檢視表的 <code>SELECT 敘述</code> 在符合某些條件的狀況之下，便能透過此檢視表更新資料 」。</p><p>列舉幾項比較主要的條件：</p><ol><li><code>SELECT 子句</code> 中沒有 <code>DISTINCT 關鍵字</code>。</li><li><code>FROM 子句</code> 中只有 1 個資料表。</li><li>沒有使用 <code>GROUP BY 子句</code>。</li><li>沒有使用 <code>HAVING 子句</code>。</li></ol><p>如果 <code>檢視表</code> 所呈現的資料，是原資料表經過彙總處理之後的結果，那麼對 <code>檢視表</code> 所執行的變更動作，資料庫當然無法判斷應該如何反應至原資料表中儲存的資料，導致無法透過 <code>檢視表</code> 更新資料。</p><p><code>檢視表</code> 中就是原本的資料表所衍生出來的產物，因此，如果直接變更原資料表的內容，<code>檢視表</code> 所看到的資料也會跟著發生變化，反之亦然，若是透過 <code>檢視表</code> 變更資料內容，資料庫也必須將變更的動作反映至原資料表，維持 2 者之間的一致性。</p><div class="tip custom-block"><p class="custom-block-title">牢記的原則 5-5</p><p><code>檢視表</code> 和資料表的資料內容是連動的，因此不能透過具有彙總動作的 <code>檢視表</code> 更新資料。</p></div><ul><li><h4 id="可透過檢視表更新的例子" tabindex="-1">可透過檢視表更新的例子 <a class="header-anchor" href="#可透過檢視表更新的例子" aria-hidden="true">#</a></h4><div class="warning custom-block"><p class="custom-block-title">範例 5-5</p><p>可更新資料的檢視表</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">VIEW</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ShohinJim</span><span style="color:#A6ACCD;"> (shohin_id, shohin_name, shohin_catalg, sell_price, buying_price, reg_date)</span></span>
<span class="line"><span style="color:#F78C6C;">AS</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> shohin_catalg </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">辦公用品</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><p>沒有彙總以及結合的 <code>SELECT 敘述</code>。</p></div><p>由於 <code>ShohinSumJim</code> 檢視表只有過濾出屬於 辦公用品的商品，所以若對此檢視表執行 <code>INSERT 敘述</code>，當然可以順利完成。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-6</p><p>可更新資料的檢視表</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#A6ACCD;"> ShohinJim </span><span style="color:#F78C6C;">VALUES</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0009</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">印章</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">辦公用品</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">95</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2009-11-30</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">注意</p><p>專用語法：<code>PostgreSQL</code></p><p>如果是 <code>PostgreSQL</code> 的資料庫，由於某些版本會將 <code>檢視表</code> 預設為只能讀取，所以執行 範例 5-6 的 <code>INSERT 敘述</code> 時，可能會看到下面的錯誤訊息。</p><p>執行結果</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">ERROR: cannot </span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> a view</span></span>
<span class="line"><span style="color:#A6ACCD;">HINT: You need an unconditional </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">UPDATE</span><span style="color:#A6ACCD;"> DO </span><span style="color:#F78C6C;">INSTEAD</span><span style="color:#A6ACCD;"> rule.</span></span>
<span class="line"></span></code></pre></div><p>遇到這種狀況的時候，在執行 <code>INSERT 敘述</code> 之前，必須先執行 範例 5-A 的敘述，來允許對檢視表更新資料，而 <code>DB2</code>、<code>MariaDB</code>和 <code>MySQL</code> 等其他 <code>DBMS</code> 則不需要此步驟。</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE OR REPLACE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">RULE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">insert_rule</span></span>
<span class="line"><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INSERT</span></span>
<span class="line"><span style="color:#F78C6C;">TO</span><span style="color:#A6ACCD;"> ShohinJim DO </span><span style="color:#F78C6C;">INSTEAD</span></span>
<span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#A6ACCD;"> Shohin </span><span style="color:#F78C6C;">VALUES</span><span style="color:#A6ACCD;"> (new.shohin_id, new.shohin_name, new.shohin_catalg, new.sell_price, new.buying_price, new.reg_date);</span></span>
<span class="line"></span></code></pre></div></div><p>當然也可以像使用資料表一樣，對此檢視表執行 <code>UPDATE</code> 或 <code>DELETE</code> 等敘述。</p></li></ul><h3 id="刪除檢視表" tabindex="-1">刪除檢視表 <a class="header-anchor" href="#刪除檢視表" aria-hidden="true">#</a></h3><p>想刪除既有的 <code>檢視表</code> 需要使用 <code>DROP VIEW 敘述</code>。</p><div class="warning custom-block"><p class="custom-block-title">語法 5-2</p><p>刪除 <code>檢視表</code> 的 <code>DROP VIEW 敘述</code></p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">VIEW</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">檢視表名稱</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">範例 5-7</p><p>刪除 ShohinSum 檢視表</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">VIEW</span><span style="color:#A6ACCD;"> ShohinSum;</span></span>
<span class="line"></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">專用語法：<code>PostgreSQL</code></p><p>在 <code>PostgreSQL</code> 上，想刪除多層檢視表架構中的來源檢視表時，會因為檢視表之間的依存關係而看到下列的錯誤訊息。</p><p>執行結果 (PostgreSQL 的狀況)</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">ERROR: cannot </span><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> view shohinsum because other objects depend </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> it.</span></span>
<span class="line"><span style="color:#A6ACCD;">DETAIL: view shohinsumjim depends </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> view shohinsum.</span></span>
<span class="line"><span style="color:#A6ACCD;">HINT: </span><span style="color:#F78C6C;">Use</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DROP</span><span style="color:#A6ACCD;"> ... CASCADE </span><span style="color:#F78C6C;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">drop</span><span style="color:#A6ACCD;"> the </span><span style="color:#F78C6C;">dependent</span><span style="color:#A6ACCD;"> objects too.</span></span>
<span class="line"></span></code></pre></div><p>這個時候需要使用下面的寫法，加上 <code>CASCADE</code> 參數，移除所有依存關係。</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">DROP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">VIEW</span><span style="color:#A6ACCD;"> ShohinSum CASCADE;</span></span>
<span class="line"></span></code></pre></div></div><h2 id="_5-2-子查詢" tabindex="-1">5-2 子查詢 <a class="header-anchor" href="#_5-2-子查詢" aria-hidden="true">#</a></h2><div class="info custom-block"><p class="custom-block-title">學習重點</p><ul><li>若要用 1 句話來形容 <code>子查詢</code>，那便是「 用過即丟的檢視表 (SELECT 敘述) 」。<code>子查詢</code> 和 <code>檢視表</code> 不同，它的 <code>SELECT 敘述</code> 在執行完畢後會立即被消除。</li><li>由於 <code>子查詢</code> 需要賦予名稱，所以請配合其處理內容取個適當的名稱。</li><li><code>純量子查詢</code> 是「 回傳結果必定為單一紀錄的單一欄位值 」的 <code>子查詢</code>。</li></ul></div><h3 id="子查詢與檢視表" tabindex="-1">子查詢與檢視表 <a class="header-anchor" href="#子查詢與檢視表" aria-hidden="true">#</a></h3><p>「 <code>子查詢 (Subquery)</code> 」功能，便是以檢視表為基礎的技術，可以說是「 用過即丟的檢視表 」。</p><p>將 <code>建立檢視表的 SELECT 敘述</code> 直接鑲嵌至 <code>FROM 子句</code> 當中。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-8</p><p>建立 ShohinSum 檢視表 與 確認用的 SELECT 敘述</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 按照商品分類分別統計商品數量的檢視表</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">VIEW</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ShohinSum</span><span style="color:#A6ACCD;"> (shohin_catalg, cnt_shohin)</span></span>
<span class="line"><span style="color:#F78C6C;">AS</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 確認檢視表的資料內容</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, cnt_shohin</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> ShohinSum</span></span>
<span class="line"></span></code></pre></div></div><p>如果改用 <code>子查詢</code> 的方式來達成相同的目的，將如同範例 5-9 所示。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-9</p><p>子查詢</p><p>專用語法：<code>SQL Server</code>、<code>DB2</code>、<code>PostgreSQL</code>、<code>MySQL</code></p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 在 FROM 子句中直接寫入建立檢視表的 SELECT 敘述</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, cnt_shohin</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> cnt_shohin</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> ShohinSum;</span></span>
<span class="line"></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">專用語法：<code>Oracle</code></p><p><code>Oracle</code> 在 <code>FROM 子句</code> 的地方不能使用 <code>AS</code> (會發生錯誤)，因此，想要在 <code>Oracle</code> 上執行 範例 5-9 敘述的時候，請將「 <code>) AS ShohinSum;</code> 」部分改為「 <code>) ShohinSum;</code> 」。</p></div><p>將原本用來定義檢視表的 <code>SELECT 敘述</code> 直接寫入 <code>FROM 子句</code> 中，這樣的寫法便稱為「 <code>子查詢</code> 」。「 <code>AS ShohinSum</code> 」為賦予此 <code>子查詢</code> 的名稱，此段 <code>SELECT 敘述</code> 在執行之後會立即消失無蹤。</p><p>其執行順序為先執行 <code>FROM 子句</code> 中的內部 <code>SELECT 敘述</code>，然後再執行外圍的 <code>SELECT 敘述</code>。</p><div class="tip custom-block"><p class="custom-block-title">牢記的原則 5-6</p><p><code>子查詢</code> 會從內部的 <code>SELECT 敘述</code> 開始執行。</p></div><ul><li><h4 id="增加子查詢的層數" tabindex="-1">增加子查詢的層數 <a class="header-anchor" href="#增加子查詢的層數" aria-hidden="true">#</a></h4><p>由於 <code>子查詢</code> 的層數原則上沒有什麼限制，<code>子查詢</code> 中的 <code>FROM 子句</code> 可以再使用 <code>子查詢</code>，而其中的 <code>FROM 子句</code> 還可以再度使用 <code>子查詢</code>，理論上是可以寫出無限多層的巢狀結構。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-10</p><p>增加子查詢巢狀結構的層數</p><p>專用語法：<code>SQL Server</code>、<code>DB2</code>、<code>PostgreSQL</code>、<code>MySQL</code></p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, cnt_shohin</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, </span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> cnt_shohin</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> ShohinSum</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> cnt_shohin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> ShohinSum2;</span></span>
<span class="line"></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">專用語法：<code>Oracle</code></p><p><code>Oracle</code> 在 <code>FROM 子句</code> 的地方不能使用 <code>AS</code> (會發生錯誤)，因此，想要在 <code>Oracle</code> 上執行 範例 5-10 敘述的時候， 請將「 <code>) AS ShohinSum;</code> 」部分改為「 <code>) ShohinSum</code> 」， 將「 <code>) AS ShohinSum2;</code> 」部分改為「 <code>) ShohinSum2</code> 」，</p></div><p>但是，隨著 <code>子查詢</code> 的階層數量增加，除了這樣複雜的 <code>SQL 敘述</code> 難以閱讀之外，與 <code>檢視表</code> 相同，同樣會對資料庫的效能造成負面影響，因此，請盡量避免使用過多層數的 <code>子查詢</code>。</p></li></ul><h3 id="子查詢的名稱" tabindex="-1">子查詢的名稱 <a class="header-anchor" href="#子查詢的名稱" aria-hidden="true">#</a></h3><p>由於原則上必須替 <code>子查詢</code> 取個稱呼，所以請在思考該 <code>子查詢</code> 的處理內容之後，再取個容易聯想的適當名稱。以「 ShohinSum 」為例，因為其功用在於彙總統計 Shohin 資料表的資料，因此使用了原本資料表的名稱，再加上 <code>Sum</code> 這個具有總和意思的單字。</p><p>替 <code>子查詢</code> 取名的時候需要使用 <code>AS</code> 關鍵字，不過某些 <code>DBMS</code> 可以省略此 <code>AS</code> 關鍵字，如 <code>Oracle</code>。</p><h3 id="純量子查詢" tabindex="-1">純量子查詢 <a class="header-anchor" href="#純量子查詢" aria-hidden="true">#</a></h3><p>「 <code>純量子查詢</code> 」是較為特殊的 <code>子查詢</code>。</p><ul><li><h4 id="什麼是純量" tabindex="-1">什麼是純量 <a class="header-anchor" href="#什麼是純量" aria-hidden="true">#</a></h4><p>「 <code>純量</code> 」譯自於 <code>Scalar</code> 這個單字，它具有「 <code>單純的數值</code> 」的意思，在資料庫以外的其他領域也能看到這個詞彙。</p><p><code>子查詢</code> 基本上會回覆多筆的紀錄，相對於此，<code>純量子查詢</code> 則是「 <code>回傳值必定為單一紀錄的單一欄位</code> 」的特殊子查詢。</p><div class="tip custom-block"><p class="custom-block-title">牢記的原則 5-7</p><p><code>純量子查詢</code> 是回傳值為單一值的子查詢。</p></div></li><li><h4 id="在-where-子句使用純量子查詢" tabindex="-1">在 WHERE 子句使用純量子查詢 <a class="header-anchor" href="#在-where-子句使用純量子查詢" aria-hidden="true">#</a></h4><p>若想「 <code>查詢販售單價高於全部商品平均販售單價的商品</code> 」，如果直接使用 <code>AVG 函數</code> 寫出如下的 <code>SQL 敘述</code>，執行之後只會得到錯誤訊息。</p><div class="danger custom-block"><p class="custom-block-title">WHERE 子句中不能使用彙總函數</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight has-highlighted-lines"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_id, shohin_name, sell_price</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> sell_price </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price);</span></span>
<span class="line"></span></code></pre></div></div><p>這裡即是 <code>純量子查詢</code> 能發揮其效果的地方，首先想要求得平均值，可執行 範例 5-11。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-11</p><p>可求得平均販售單價的純量子查詢</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin;</span></span>
<span class="line"></span></code></pre></div></div><p>可以將這個結果數值直接應用於 <code>WHERE 子句</code> 的比較式中。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-12</p><p>篩選出販售單價 (sell_price) 高於全部商品平均販售單價的商品</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight has-highlighted-lines"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_id, shohin_name, sell_price</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> sell_price </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">                    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin;)</span></span>
<span class="line"></span></code></pre></div></div><p>使用 <code>子查詢</code> 功能的 <code>SQL 敘述</code>，會先從 <code>子查詢</code> 的部分開始執行。</p></li></ul><h3 id="可寫入純量子查詢的位置" tabindex="-1">可寫入純量子查詢的位置 <a class="header-anchor" href="#可寫入純量子查詢的位置" aria-hidden="true">#</a></h3><p><code>SQL 敘述</code> 中，可以寫入 <code>純量子查詢</code> 的位置，不僅只限於 <code>WHERE 子句</code>，基本上，能寫入 <code>純量值</code> 的地方都可以改寫為 <code>純量子查詢</code> 的形式，不論是 <code>SELECT 子句</code>、<code>GROUP BY 子句</code>、<code>HAVING 子句</code> 以及 <code>ORDER BY 子句</code> 等。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-13</p><p>在 SELECT 子句中使用純量子查詢</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight has-highlighted-lines"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_id,</span></span>
<span class="line"><span style="color:#A6ACCD;">       shohin_name,</span></span>
<span class="line"><span style="color:#A6ACCD;">       sell_price,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">       (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> avg_price</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin;</span></span>
<span class="line"></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">範例 5-14</p><p>在 HAVING 子句中使用純量子查詢</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight has-highlighted-lines"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">HAVING</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price) </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">                          </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin);</span></span>
<span class="line"></span></code></pre></div></div><h3 id="使用純量子查詢的需注意事項" tabindex="-1">使用純量子查詢的需注意事項 <a class="header-anchor" href="#使用純量子查詢的需注意事項" aria-hidden="true">#</a></h3><p>想要使用 <code>純量子查詢</code> 的時候必須特別注意的地方，那便是「 <code>絕對不能讓子查詢回傳包含多筆紀錄的結果</code> 」，因為當 <code>子查詢</code> 回傳多筆紀錄的時候，已經不屬於 <code>純量子查詢</code>，而只是一般子查詢的用法，如此一來，既不能使用 <code>=</code> 或 <code>&lt;&gt;</code> 等運算子來和 <code>純量值</code> 做比較，也無法寫入 <code>SELECT 子句</code> 等位置之中。</p><h2 id="_5-3-關聯子查詢-correlated-subquery" tabindex="-1">5-3 關聯子查詢 (Correlated Subquery) <a class="header-anchor" href="#_5-3-關聯子查詢-correlated-subquery" aria-hidden="true">#</a></h2><div class="info custom-block"><p class="custom-block-title">學習重點</p><ul><li><code>關聯子查詢</code> 能在細分後的群組內比較大小。</li><li>和 <code>GROUP BY 子句</code> 相同，<code>關聯子查詢</code> 也具有將資料群組「 <code>切開</code> 」的功能。</li><li><code>關聯子查詢</code> 的連結條件，必須寫在 <code>子查詢</code> 之中，否則會發生錯誤，此點請特別注意。</li></ul></div><h3 id="一般子查詢與關聯子查詢的差異" tabindex="-1">一般子查詢與關聯子查詢的差異 <a class="header-anchor" href="#一般子查詢與關聯子查詢的差異" aria-hidden="true">#</a></h3><ul><li><h4 id="在各商品分類中比較平均販售單價" tabindex="-1">在各商品分類中比較平均販售單價 <a class="header-anchor" href="#在各商品分類中比較平均販售單價" aria-hidden="true">#</a></h4><p>先按照分類將商品「 細分成 」較小的群組，然後在各群組內比較分類平均售價與各商品販售單價的大小。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-15</p><p>求得各商品分類的平均售價</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg;</span></span>
<span class="line"></span></code></pre></div></div><p>不過，如果直接將上面的 <code>SELECT 敘述</code> 當作 <code>子查詢</code> 寫入 <code>WHERE 子句</code>，只會得到錯誤訊息。</p><div class="danger custom-block"><p class="custom-block-title">錯誤的子查詢寫法</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight has-highlighted-lines"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_id, shohin_name, sell_price</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> sell_price </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">                    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">                    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg);</span></span>
<span class="line"></span></code></pre></div><p>此 <code>子查詢</code> 會回傳多筆紀錄，這違背了 <code>純量子查詢</code> 的原則。</p></div></li><li><h3 id="使用關聯子查詢的解決方式" tabindex="-1">使用關聯子查詢的解決方式 <a class="header-anchor" href="#使用關聯子查詢的解決方式" aria-hidden="true">#</a></h3><p>只要在先前的 <code>SELECT 敘述</code> 中增加 1 行內容，即可變成能獲得所需結果的 <code>SELECT 敘述</code>。</p><div class="warning custom-block"><p class="custom-block-title">範例 5-16</p><p>利用關聯子查詢在各商品分類中比較平均售價</p><p>專用語法：<code>SQL Server</code>、<code>DB2</code>、<code>PostgreSQL</code>、<code>MySQL</code></p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight has-highlighted-lines"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_catalg, shohin_name, sell_price</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> S1</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> sell_price </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">                    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> S2</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">                    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> S1.shohin_catalg </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> S2.shohin_catalg</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg);</span></span>
<span class="line"></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">專用語法：<code>Oracle</code></p><p><code>Oracle</code> 在 <code>FROM 子句</code> 的地方不能使用 <code>AS</code> (會發生錯誤)，因此，想要在 <code>Oracle</code> 上執行 範例 5-16 敘述的時候，</p><p>請將「 <code>FROM Shohin AS S1</code> 」部分改為「 <code>FROM Shohin S1</code> 」，</p><p>將「 <code>FROM Shohin AS S2</code> 」部分改為「 <code>FROM Shohin S2</code> 」。</p></div><p>執行之後，便能針對辦公用品、衣物和廚房用品這 3 個分類，分別篩選出各群組中，販售單價高於分類平均售價的商品。</p><p>這裡的重點在於 <code>子查詢內增加的 WHERE 子句條件</code>。如果以中文來表達其意思，即相當於「 <code>在相同的商品分類中</code>，比較各商品的販售單價和平均售價 」。</p><p>此次作為比較對象的資料來自於相同的 <code>Shohin 資料表</code>，所以需要以 <code>S1</code> 和 <code>S2</code> 的資料表別名作為區別。使用 <code>關聯子查詢</code> 的時候，必須像這樣在欄位名稱前方加上資料表別名，以「 <code>&lt;資料表別名&gt;.&lt;欄位名稱&gt;</code> 」的形式來撰寫。</p><p><code>關聯子查詢</code> 可以用於限定資料表部分群組資料，而非整個資料表進行比較的需求，因此，運用 <code>關聯子查詢</code> 的時候，一般會使用「 <code>綁定</code> 」或「 <code>限制</code> 」的說法來形容，以此次的範例來說，可以說「 <code>綁定商品分類</code> 」來與平均售價做比較。</p><div class="tip custom-block"><p class="custom-block-title">牢記的原則 5-8</p><p><code>關聯子查詢</code> 可以在細分後的群組內比較大小</p></div></li></ul><h3 id="關聯子查詢也能進行資料分群" tabindex="-1">關聯子查詢也能進行資料分群 <a class="header-anchor" href="#關聯子查詢也能進行資料分群" aria-hidden="true">#</a></h3><p><code>關聯子查詢</code> 也和 <code>GROUP BY 子句</code> 一樣，具有將資料集合進行「 <code>分群</code> 」的功能。</p><p>子查詢的部分會在各商品分類的範圍中，分別計算該分類的平均售價，然後到外圍 <code>SELECT 敘述</code> 的 <code>WHERE 子句</code>，以各商品的售價和各分類的平均售價做比較。</p><p>當商品分類改變的時候，用來比較的平均售價也隨之改變，如此一來便能比較各商品的販售單價與平均售價之間的大小關係。</p><h3 id="連結條件必須寫在子查詢內" tabindex="-1">連結條件必須寫在子查詢內 <a class="header-anchor" href="#連結條件必須寫在子查詢內" aria-hidden="true">#</a></h3><p><code>關聯名稱</code>，指的是 <code>S1</code> 和 <code>S2</code> 這些替資料表所取的別名，而 <code>領域 (Scope)</code> 則是這些名稱的 <code>存活範圍 (有效範圍)</code>，換句話說，<code>關聯名稱</code> 具有只能在某些範圍內使用的限制。</p><p>具體來說，在 <code>子查詢</code> 內部所賦予的 <code>關聯名稱</code>，也只能在該 <code>子查詢</code> 的範圍內使用。</p><p><code>SQL 敘述</code> 會從最內部的 <code>子查詢</code> 開始逐層往外執行，所以先前範例的 <code>子查詢</code> 部分執行完畢的時候，只會留下最後回傳的結果，而來源資料表的別名 <code>S2</code> 早已消失，因此，當執行的順序來到 <code>子查詢</code> 的外側時，<code>S2</code> 這個名稱已經不復存在。</p><h2 id="自我練習" tabindex="-1">自我練習 <a class="header-anchor" href="#自我練習" aria-hidden="true">#</a></h2><ul><li><p>5.1 請建立滿足下列 3 個條件的 <code>檢視表</code>，此 <code>檢視表</code> 的名稱可訂為 <code>ViewExercise5_1</code>。另外，這裡同樣只需要引用先前一直使用的 <code>Shohin 資料表</code>，而且期中的資料為儲存著最初 8 筆紀錄的狀態。</p><ul><li><code>條件 1</code>：販售單價高於 1000 元。</li><li><code>條件 2</code>：登錄日期為 2009 年 9 月 20 日。</li><li><code>條件 3</code>：需要包含商品名稱、販售單價以及登錄日期等 3 個欄位。</li></ul><p>若對此 <code>檢視表</code> 執行以下的 <code>SELECT 敘述</code>，應該要獲得下方的執行結果。</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> ViewExercise5_1;</span></span>
<span class="line"></span></code></pre></div><p>執行結果</p><table><thead><tr><th>shohin_name</th><th>sell_price</th><th>reg_date</th></tr></thead><tbody><tr><td>T恤</td><td>1000</td><td>2009-09-20</td></tr><tr><td>菜刀</td><td>3000</td><td>2009-09-20</td></tr></tbody></table><details class="details custom-block"><summary>練習</summary><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">VIEW</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ViewExercise5_1</span><span style="color:#A6ACCD;"> (shohin_name, sell_price, reg_date)</span></span>
<span class="line"><span style="color:#F78C6C;">AS</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> shohin_name, sell_price, reg_date</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> sell_price </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> &amp;&amp; reg_date </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2009-09-20</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div></details></li><li><p>5.2 請試著針對問題 5.1 所建立的 <code>ViewExercise5_1</code> <code>檢視表</code> 存入如下的資料，請問結果會是如何呢？</p><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#A6ACCD;"> ViewExercise5_1 </span><span style="color:#F78C6C;">VALUES</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小刀</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">300</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2009-11-02</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"></span></code></pre></div><details class="details custom-block"><summary>練習</summary><p>由於主要資料表 <code>Shohin</code> 有 3 個欄位必填 (<code>shohin_id</code>、<code>shohin_name</code>、<code>shohin_catalg</code>)，<code>檢視表</code> 原本就缺少必填欄位，且主表未設定 Default 預設值，就算新增 <code>檢視表</code> 資料時，欄位有對應，仍無法新增。</p></details></li><li><p>5.3 請思考如何寫下能獲得下列結果的 <code>SELECT 敘述</code>，最右側的 <code>sell_price_all</code> 欄位為全部商品的平均販售單價。</p><p>執行結果</p><table><thead><tr><th>shohin_id</th><th>shohin_name</th><th>shohin_catalg</th><th style="text-align:right;">sell_price</th><th style="text-align:right;">sell_price_all</th></tr></thead><tbody><tr><td>0001</td><td>T恤</td><td>衣物</td><td style="text-align:right;">1000</td><td style="text-align:right;">2097.5000000000000000</td></tr><tr><td>0002</td><td>打孔機</td><td>辦公用品</td><td style="text-align:right;">500</td><td style="text-align:right;">2097.5000000000000000</td></tr><tr><td>0003</td><td>襯衫</td><td>衣物</td><td style="text-align:right;">4000</td><td style="text-align:right;">2097.5000000000000000</td></tr><tr><td>0004</td><td>菜刀</td><td>廚房用品</td><td style="text-align:right;">3000</td><td style="text-align:right;">2097.5000000000000000</td></tr><tr><td>0005</td><td>壓力鍋</td><td>廚房用品</td><td style="text-align:right;">6800</td><td style="text-align:right;">2097.5000000000000000</td></tr><tr><td>0006</td><td>叉子</td><td>廚房用品</td><td style="text-align:right;">500</td><td style="text-align:right;">2097.5000000000000000</td></tr><tr><td>0007</td><td>刨絲器</td><td>廚房用品</td><td style="text-align:right;">880</td><td style="text-align:right;">2097.5000000000000000</td></tr><tr><td>0008</td><td>鋼珠筆</td><td>辦公用品</td><td style="text-align:right;">100</td><td style="text-align:right;">2097.5000000000000000</td></tr></tbody></table><details class="details custom-block"><summary>練習</summary><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">  shohin_id,</span></span>
<span class="line"><span style="color:#A6ACCD;">  shohin_name,</span></span>
<span class="line"><span style="color:#A6ACCD;">  shohin_catalg,</span></span>
<span class="line"><span style="color:#A6ACCD;">  sell_price, (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin</span></span>
<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> sell_price_all</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> shohin;</span></span>
<span class="line"></span></code></pre></div></details></li><li><p>5.4 請試著撰寫 <code>SQL 敘述</code> 建立名為 <code>AvgPriceByCatalg</code> 的 <code>檢視表</code>，此 <code>檢視表</code> 的資料如下所示，而來源資料表的條件和問題 5.1 相同。</p><p>執行結果</p><table><thead><tr><th>shohin_id</th><th>shohin_name</th><th>shohin_catalg</th><th style="text-align:right;">sell_price</th><th style="text-align:right;">sell_price_all</th></tr></thead><tbody><tr><td>0001</td><td>T恤</td><td>衣物</td><td style="text-align:right;">1000</td><td style="text-align:right;">2500.0000000000000000</td></tr><tr><td>0002</td><td>打孔機</td><td>辦公用品</td><td style="text-align:right;">500</td><td style="text-align:right;">300.0000000000000000</td></tr><tr><td>0003</td><td>襯衫</td><td>衣物</td><td style="text-align:right;">4000</td><td style="text-align:right;">2500.0000000000000000</td></tr><tr><td>0004</td><td>菜刀</td><td>廚房用品</td><td style="text-align:right;">3000</td><td style="text-align:right;">2795.0000000000000000</td></tr><tr><td>0005</td><td>壓力鍋</td><td>廚房用品</td><td style="text-align:right;">6800</td><td style="text-align:right;">2795.0000000000000000</td></tr><tr><td>0006</td><td>叉子</td><td>廚房用品</td><td style="text-align:right;">500</td><td style="text-align:right;">2795.0000000000000000</td></tr><tr><td>0007</td><td>刨絲器</td><td>廚房用品</td><td style="text-align:right;">880</td><td style="text-align:right;">2795.0000000000000000</td></tr><tr><td>0008</td><td>鋼珠筆</td><td>辦公用品</td><td style="text-align:right;">100</td><td style="text-align:right;">300.0000000000000000</td></tr></tbody></table><details class="details custom-block"><summary>提示</summary><ul><li>此題的重點在於 <code>avg_sell_price</code> 欄位，這個欄位和問題 5.3 不同，是各商品分類的平均販售單價，和本章 5-3 節 <code>相關子查詢</code> 所求得的結果相同，也就是說，撰寫的時候請使用 <code>相關子查詢</code>，不過您必須自行寫出完整的敘述。</li></ul></details><details class="details custom-block"><summary>練習</summary><div class="language-SQL"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">  shohin_id,</span></span>
<span class="line"><span style="color:#A6ACCD;">  shohin_name,</span></span>
<span class="line"><span style="color:#A6ACCD;">  shohin_catalg,</span></span>
<span class="line"><span style="color:#A6ACCD;">  sell_price, (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AVG</span><span style="color:#A6ACCD;">(sell_price)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> Shohin </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> S2</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> S1.shohin_catalg </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> S2.shohin_catalg</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> shohin_catalg</span></span>
<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> sell_price_all</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> shohin </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> S1;</span></span>
<span class="line"></span></code></pre></div></details></li></ul></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-c5936a1e data-v-e033cd21><!----><div class="prev-next" data-v-e033cd21><div class="pager" data-v-e033cd21><a class="pager-link prev" href="/vitepress-SQL-zero/guide/chapter_4.html" data-v-e033cd21><span class="desc" data-v-e033cd21>Previous page</span><span class="title" data-v-e033cd21>第 4 章 更新資料</span></a></div><div class="has-prev pager" data-v-e033cd21><a class="pager-link next" href="/vitepress-SQL-zero/guide/chapter_6.html" data-v-e033cd21><span class="desc" data-v-e033cd21>Next page</span><span class="title" data-v-e033cd21>第 6 章 函數、述詞、CASE 運算式</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-93a960b4 data-v-d24360a6><div class="container" data-v-d24360a6><!----><p class="copyright" data-v-d24360a6>MIT Lincensed | Copyright © 2023-present Eason</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"guide_chapter_0.md\":\"de036069\",\"guide_chapter_1.md\":\"ca727084\",\"guide_chapter_2.md\":\"a4eb522b\",\"guide_chapter_3.md\":\"4a9ef05f\",\"guide_chapter_5.md\":\"3d608a90\",\"guide_chapter_4.md\":\"443483c4\",\"guide_chapter_7.md\":\"dbd1dc90\",\"guide_chapter_6.md\":\"fdc0f91d\",\"guide_chapter_8.md\":\"6e316234\",\"index.md\":\"04c6d6e3\",\"guide_chapter_9.md\":\"9c9f9594\"}")</script>
    <script type="module" async src="/vitepress-SQL-zero/assets/app.12066fee.js"></script>
    
  </body>
</html>